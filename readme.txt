Tennis Brain: "God Mode" Betting Engine

1. Project Overview

Tennis Brain is a professional-grade sports analytics and betting platform designed to predict tennis match outcomes with high precision. It utilizes a "God Mode" feature set that goes beyond standard Elo ratings by incorporating Physical Metrics (Height, Handedness), Psychological Metrics (Clutch/Break Point Performance), and Physiological Metrics (Fatigue/Schedule load).

The system operates as a full-stack pipeline:

Data Ingestion: Combines 25 years of historical data (Jeff Sackmann) with live daily updates (TennisAPI).

Database: A persistent SQLite database (tennis_data.db) storing match history.

Modeling: An XGBoost classifier trained on leakage-free, chronologically reconstructed player states.

Live Trading: A Streamlit dashboard that compares Model Probabilities against Live Pinnacle Odds to identify Expected Value (EV).

2. Architecture & Data Flow

The Data Pipeline

Historical Base: 2000â€“2025 match data from Jeff Sackmann's archives.

The Gap Filler: A backfill script pulls matches between the archive end date and "Yesterday" via TennisAPI.

Daily Feed: A daily script fetches yesterday's results to keep the database live.

The "State" Engine

Unlike simple models that look up static stats, this system replays history. To determine a player's rating for today, it iterates through every match in the database from 2000 to present day, updating:

Elo: Dynamic K-factor updates.

Form: Rolling averages of last 20 matches.

Momentum: Rolling averages of last 5 matches.

Clutch: Cumulative Break Points Saved / Faced (min. sample size filters apply).

Fatigue: Count of matches played in the last 14 days relative to the target match date.

3. File Manifest & Usage

A. Core Infrastructure

tennis_data.db: The SQLite database containing the matches table. This is the single source of truth.

players_live.json: A JSON snapshot generated by save_current_state_v4.py. It contains the current Elo, Form, Fatigue, and Clutch stats for every active player. Used by the app for live predictions.

player_pressure_stats.json: (Legacy/Auxiliary) Specific breakdown of pressure stats, now largely integrated into the live json.

tennis_model_god_mode.json: The trained XGBoost model file.

B. Data Acquisition Scripts

download_data.py: Downloads raw CSVs from Jeff Sackmann's GitHub (ATP & Challengers) and merges them into a master CSV.

clean_database.py: Removes duplicate rows and purges "junk" data (Juniors/Exhibitions) from the SQLite database.

backfill_filtered.py: Loops through a specific date range (e.g., June 2025 - Dec 2025) to fetch missing matches from TennisAPI. Contains strict logic to filter out WTA/Doubles.

daily_update_tennisapi_v2.py: [CRITICAL] Run this every morning. It fetches yesterday's finished matches from TennisAPI, parses the stats (Aces, BP Saved), and updates tennis_data.db. It then auto-triggers a state update.

C. Feature Engineering & Modeling

build_features_v3.py: The "Time Machine." It replays the entire database to create a training dataset (tennis_brain_features.csv). It calculates features as they would have appeared before each match to prevent data leakage.

train_model_v2.py: Trains the XGBoost classifier on the features csv. It creates "Mirror" rows (swapping P1/P2) to ensure the model is unbiased. Saves the result to tennis_model_god_mode.json.

save_current_state_v4.py: Similar to build_features, but instead of creating a training set, it runs through history to generate the final state of every player (Elo, Fatigue, Clutch) for today. Saves to players_live.json.

D. The Application (Frontend)

app.py: The Streamlit Dashboard.

Live Betting Board: Fetches today's schedule, predicts every match, compares with Pinnacle odds, and highlights +EV bets in green.

Player Deep Dive: Spider charts for attributes, physical profile, and match history.

Simulator: Head-to-head prediction tool.

pinnacle_client.py: A helper module imported by app.py. Connects to the Pinnacle API to fetch live moneyline odds and convert them to decimal format.

4. Feature Dictionary ("God Mode")

The model uses the following inputs for every prediction:

Feature

Description

Importance

Elo Diff

Difference in dynamic Elo ratings.

High

Form (L20)

Win % in last 20 matches.

Med

Momentum (L5)

Win % in last 5 matches.

High

Clutch (Pressure)

Career Break Point Save % (weighted by volume).

Very High

Fatigue Diff

Difference in matches played in the last 14 days.

Very High

Height Diff

Difference in height (cm). Captures serve dynamics.

Med

Handedness

Binary flag (Is P1/P2 Lefty?). Captures matchup advantages.

Low/Med

Surface

One-hot encoded (Hard, Clay, Grass).

Med

Serve/Return Rating

Rolling average of Serve/Return points won %.

Med

5. Operational Manual

Daily Routine (Trading Days)

Update Data (07:00 AM):

python daily_update_tennisapi_v2.py


Wait for it to finish saving players_live.json.

Launch Dashboard:

streamlit run app.py


Execute:

Go to "Live Betting Board".

Click "Refresh Market Data".

Bet on rows highlighted in Green (Positive EV > 5%).

Monthly Maintenance (Re-calibration)

Rebuild Training Data:

python build_features_v3.py


Retrain Model:

python train_model_v2.py


Check if accuracy stays between 65%-68%. If it jumps to 75%+, check for leakage.

6. Configuration & APIs

TennisAPI (RapidAPI)

Host: tennisapi1.p.rapidapi.com

Key: 39c716c052mshef8a7bf43953ef6p11b284jsnf4d9e5df15ee (Note: Basic Tier limits apply, be careful with backfills).

Usage: Used for Daily Schedules, Results, and Player Physical Data (Height/Hand).

Pinnacle API (RapidAPI)

Host: pinaculo.p.rapidapi.com

Key: 39c716c052mshef8a7bf43953ef6p11b284jsnf4d9e5df15ee

Usage: Used solely for fetching live market odds to calculate Expected Value.

Python Environment

Required libraries:

pandas, numpy, sqlite3 (Standard data handling)

xgboost, scikit-learn (Machine Learning)

streamlit, plotly (UI and Visualization)

requests (API fetching)

rapidfuzz (Fuzzy string matching for linking API names to Database names)

7. Troubleshooting

App shows "No matches found":

Check daily_update_tennisapi_v2.py output. Did it run?

Check if Pinnacle has released odds yet (ITF odds often drop late).

Probabilities look wrong (e.g., 90%):

Data Leakage. Re-run build_features_v3.py and ensure train_model_v2.py is using the new file.

Player Stats are 0.60 (Default):

The player is likely new or has fewer than 10 matches in the database. Run save_current_state_v4.py to ensure the latest stats are compiled.